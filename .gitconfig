[user]
    name = Pete Chudykowski
    email = pete.chudykowski@dreamhost.com

[core]
    ; text-editor
    editor = vim

[color]
    ui = true
    diff = true
    pager = true
    status = auto
    branch = auto

[alias]
    ; shortcuts
    ci = commit
    co = checkout
    br = branch
    st = status

    ; TBI:
    ; `git trim` - maintain your tree: trim old branches!
    ;   Delete all local branches which track branches that
    ;   no longer exist on remote.
    trim = "!trim() {\
        echo "" && echo \"To Be Implemented\" && echo "";\
    };\
    trim"

    ; `git dev` - a shortcut to your dev branch.
    ;
    ; USAGE:
    ; git dev <new_branch> [branch_from | default:master]
    ;
    ; FUNCTION:
    ; if <new_branch> already exists at origin:
    ;   create a local branch tracking the remote one.
    ; if it does not:
    ;   create <new_branch> at origin
    ;   and a local one tracking the remote one.
    ; start dev-ing
    dev = "!dev() {\
        R=\"\\033[1;31m\";\
        G=\"\\033[1;32m\";\
        Y=\"\\033[1;33m\";\
        B=\"\\033[1;34m\";\
        N=\"\\033[0m\";\
        newbranch=$1;\
        frombranch=$2;\
        [ -z $frombranch ] && frombranch='master';\
        \
        [ -z $newbranch ]\
            && printf \"\\n${R}Specify branch name!${N}\\n\"\
            && printf \"\\n${Y}USAGE: git dev <new_branch> [branch_from | default:master]${N}\\n\"\
            && printf \"\\n\" && exit 1;\
        \
        printf \"\\n${B}git fetch...${N}\\n\" && git fetch;\
        printf \"\\n${Y}Checking if branch $newbranch already exists on remote${N}\\n\";\
        printf \"\\n${B}git ls-remote --heads origin $newbranch$ ...${N}\\n\";\
        printf \"\\n\";\
        alreadythere=$(git ls-remote --heads origin $newbranch);\
        \
        [ -z \"$alreadythere\" ]\
            && printf \"\\n${Y}Branch ${newbranch} does not exist at origin. Creating one from ${frombranch}\\n\"\
            && printf \"\\n${B}git checkout $frombranch ...${N}\\n\"\
            && git checkout $frombranch\
            \
            && printf \"\\n${Y}Updating $frombranch\\n\"\
            && printf \"\\n${B}git pull --rebase ...${N}\\n\"\
            && git pull --rebase\
            \
            && printf \"\\n${Y}Branching into $newbranch from $frombranch\\n\"\
            && printf \"\\n${B}git checkout -b $newbranch ...${N}\\n\"\
            && git checkout -b $newbranch\
            \
            && printf \"\\n${Y}Creating $newbranch on remote\\n\"\
            && printf \"\\n${B}git push origin $newbranch ...${N}\\n\"\
            && git push origin $newbranch\
            \
            && printf \"\\n${Y}Setting $newbranch to track remote\\n\"\
            && printf \"\\n${B}git branch -u origin/$newbranch ...${N}\\n\"\
            && git branch -u origin/$newbranch\
            && printf \"\\n${G}You are tracking a BRAND NEW origin/$newbranch which branched from origin/$frombranch\\n\"\
            && printf \"\\nDo your DEVest!${N}\\n\"\
            && printf \"\\n\" && exit 0;\
        \
        [ -n \"$alreadythere\" ]\
            && printf \"\\n${Y}Branch ${newbranch} already exists at origin.\\n\"\
            && printf \"\\nBranching and tracking from origin/$newbranch\\n\"\
            && printf \"\\n${B}git branch $newbranch --track origin/$newbranch ...${N}\\n\"\
            && git branch $newbranch --track origin/$newbranch\
            && printf \"\\n${Y}Checking out $newbranch${N}\\n\"\
            && printf \"\\n${B}git checkout $newbranch ...${N}\\n\"\
            && git checkout $newbranch\
            && printf \"\\n${G}You are on a NEW LOCAL BRANCH tracking an ALREADY EXISTING origin/$newbranch\\n\"\
            && printf \"\\nDo your DEVest!${N}\\n\"\
            && printf \"\\n\" && exit 0;\
        \
    };\
    dev"

    ; Useful aliases for Gerrit courtesy of Stephon Striplin

    ; git review [branch_for_review]
    ; interface to pushing refs for review to Gerrit
    ; defaults to the tracked remote branch
    ; if the current branch is not tracking anything
    ; then defaults to master
    review = "!review() {\
        merge=$1;\
        [ -z $merge ] && {\
            branch=$(git for-each-ref --format='%(refname:short)' $(git symbolic-ref HEAD));\
            merge=$(git config --get branch.$branch.merge | cut -d/ -f3);\
        };\
        [ -z $merge ] && merge=master;\
        git push origin HEAD:refs/for/$merge;\
    };\
    review"

    ; git draft [branch_for_draft]
    ; interface to pushing refs for draft to Gerrit
    ; defaults to the tracked remote branch
    ; if the current branch is not tracking anything
    ; then defaults to master
    draft = "!draft() {\
        merge=$1;\
        [ -z $merge ] && {\
            branch=$(git for-each-ref --format='%(refname:short)' $(git symbolic-ref HEAD));\
            merge=$(git config --get branch.$branch.merge | cut -d/ -f3);\
        };\
        [ -z $merge ] && merge=master;\
        git push origin HEAD:refs/drafts/$merge;\
    };\
    draft"

    ; git track <new_branch> [branch_to_track]
    ; automatically set up a tracking branch
    ; defaults to tracking origin/master
    track = "!track() {\
        newbranch=$1;\
        [ -z $newbranch ] && echo \"Specify a branch\" && exit 1;\
        trackedbranch=$2;\
        [ -z $trackedbranch ] && trackedbranch='origin/master';\
        git checkout -b $newbranch --track $trackedbranch;\
    };\
    track"

    ; works exactly the same as track, but I found no way to do
    ; start = track
    start = "!track() {\
        newbranch=$1;\
        [ -z $newbranch ] && echo \"Specify a branch\" && exit 1;\
        trackedbranch=$2;\
        [ -z $trackedbranch ] && trackedbranch='origin/master';\
        git checkout -b $newbranch --track $trackedbranch;\
    };\
    track"

    ; git finish [branch_to_delete]
    finish = "!finish() {\
        deletebranch=$1;\
        [ -z $deletebranch ] &&\
            deletebranch=$(git for-each-ref --format='%(refname:short)'\
                $(git symbolic-ref HEAD));\
        [[ \"$deletebranch\" == 'master' ]] &&\
            echo \"Can't delete master\" && exit 1;\
        git checkout master &&\
        git pull --rebase &&\
        git branch -D $deletebranch;\
    };\
    finish"

    ; git create-branch
    create-branch = "!create_branch() {\
        branch_from=$1;\
        new_branch=$2;\
        git fetch &&\
        git push origin $branch_from:refs/heads/$new_branch;\
    };\
    create_branch"

[push]
    default = simple
